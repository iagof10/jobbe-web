@model long

@{
    ViewData["Title"] = "Home Page";
}

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en" data-footer="true" data-scrollspy="true">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Acorn Admin Template | List Plugin</title>
    <meta name="description"
          content="Tiny, invisible and simple, yet powerful and incredibly fast vanilla JavaScript that adds search, sort, filters and flexibility to plain HTML lists, tables, or anything." />
    <!-- Favicon Tags Start -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../img/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../img/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../img/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../img/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../img/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../img/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../img/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../img/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../img/favicon/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../img/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../img/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../img/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../img/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../img/favicon/mstile-310x310.png" />
    <!-- Favicon Tags End -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
    <script src="https://unpkg.com/sweetalert2@7.8.2/dist/sweetalert2.all.js"></script>
    <!-- Font Tags Start -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../font/CS-Interface/style.css" />
    <!-- Font Tags End -->
    <!-- Vendor Styles Start -->
    <link rel="stylesheet" href="../css/vendor/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/vendor/OverlayScrollbars.min.css" />

    <!-- Vendor Styles End -->
    <!-- Template Base Styles Start -->
    <link rel="stylesheet" href="../css/styles.css" />
    <!-- Template Base Styles End -->

    <link rel="stylesheet" href="../css/main.css" />
    <script src="../js/base/loader.js"></script>
</head>

<body style="padding-bottom: 0px">
    <div id="root">
        <main style="padding-top: 5vh;">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <div class="row">
                            <div>
                                <div id="divSubCategorias" class="row g-2">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="d-grid gap-2 mb-3">
                    <button id="btnFinalizar" class="btn btn-primary" type="button">Tudo Pronto!</button>
                </div>
            </div>
        </main>
    </div>
    <!-- Vendor Scripts Start -->
    <script src="../js/vendor/jquery-3.5.1.min.js"></script>
    <script src="../js/vendor/bootstrap.bundle.min.js"></script>
    <script src="../js/vendor/OverlayScrollbars.min.js"></script>
    <script src="../js/vendor/autoComplete.min.js"></script>
    <script src="../js/vendor/clamp.min.js"></script>
    <script src="../js/cs/scrollspy.js"></script>
    <script src="../js/vendor/list.js"></script>
    <!-- Vendor Scripts End -->
    <!-- Template Base Scripts Start -->
    <script src="../font/CS-Line/csicons.min.js"></script>
    <script src="../js/base/helpers.js"></script>
    <script src="../js/base/globals.js"></script>
    <script src="../js/base/nav.js"></script>
    <script src="../js/base/search.js"></script>
    <script src="../js/base/settings.js"></script>
    <script src="../js/base/init.js"></script>
    <!-- Template Base Scripts End -->
    <!-- Page Specific Scripts Start -->
    <script src="../js/plugins/lists.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/scripts.js"></script>
    <!-- Page Specific Scripts End -->

    <script>

        let subCategorias
        let idUsuario

        document.getElementById("btnFinalizar").addEventListener("click", salvarRegistro, false);

        function salvarRegistro() {

            subCategoriasId = []

            for (let i = 0; i < subCategorias.length; i = i + 1) {
                if (document.getElementById(subCategorias[i].id).checked) {
                    subCategoriasId.push(subCategorias[i].id)
                }
            }

            const ajax = new XMLHttpRequest();
            ajax.open('GET', 'https://localhost:44335/GetSessionUser');
            ajax.responseType = 'json';
            ajax.onload = function (e) {
                if (this.status == 200) {

                    idUsuario = this.response

                    var ajax = new XMLHttpRequest();
                    ajax.open("POST", "https://localhost:44371/api/UsuarioPrestador/vincula-categoria");
                    ajax.setRequestHeader("Content-Type", "application/json");
                    ajax.send(JSON.stringify({ idUsuario: idUsuario, idCategoria: @Model, subCategoriasId: subCategoriasId}));
                    ajax.onreadystatechange = function () {
                        if (ajax.status == 200) {

                            alertSucess('Bem vindo ao Jobbe!', 'Parabéns, agora você pode aproveitar os recursos do Jobbe.')

                        } else {
                            alertErro()
                        }
                    }
                }
            };

            ajax.send();
        }

        getSubCategoria()

        function getSubCategoria() {

            const ajax = new XMLHttpRequest();
            ajax.open('GET', 'https://localhost:44371/api/SubCategoria?idCategoria=' + @Model);
            ajax.responseType = 'json';
            ajax.onload = function (e) {
                if (this.status == 200) {
                    subCategorias = this.response.data
                    addCode(this.response.data)
                    console.log('response', this.response); // JSON response
                }
            };

            ajax.send();
        }

        function addCode(subCategorias) {

            for (let i = 0; i < subCategorias.length; i = i + 1) {

                var html = `
                          <div>
                            <label class="form-check custom-card w-100 position-relative p-0 m-0">
                                    <input id="` + subCategorias[i].id + `" type="checkbox" class="form-check-input position-absolute e-2 t-2 z-index-1" />
                                    <span class="card form-check-label w-100">
                                        <span class="card-body text-center">
                                            <i data-cs-icon="pepper" class="text-primary"></i>
                                            <span class="heading mt-3 text-body text-primary d-block">` + subCategorias[i].name + `</span>
                                            <span class="text-extra-small fw-medium text-muted d-block">14 PRODUCTS</span>
                                        </span>
                                    </span>
                                </label>
                           </div>
                        `;

                document.getElementById("divSubCategorias").innerHTML += html
            }
        }

        function alertErro() {
            sweetAlert("Algo deu errado!", "Não foi possível salvar o registro.", "error")
        }

        function alertSucess(title, message) {
            swal({
                title: title,
                text: message,
                type: 'success',
                showCancelButton: false,
                confirmButtonColor: '#1ea8e7',
                confirmButtonText: 'Yes!'
            }).then(() => {
                window.location.replace("https://localhost:44335/Perfil/Perfil");
            });
            //sweetAlert("Parabéns, você está a um passo de ser exibido para milhões de pessoas", "Preencha a categoria do seu trabalho.", "success")
        }

    </script>
</body>
</html>
